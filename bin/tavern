#!/usr/bin/env node
/*
 * tavern
 * https://github.com/JoshuaWise/tavern
 *
 * Copyright (c) 2015 Joshua Wise, contributors
 * Licensed under the MIT license.
 * https://github.com/JoshuaWise/tavern/LICENSE
 */
 
'use strict';
process.title = 'tavern-cli';

var commands = {
	'': require('../lib/cli/help'),
	'help': require('../lib/cli/help'),
	// 'update': require('../lib/cli/commands/update'),
	'init': require('../lib/cli/commands/init'),
	'open': require('../lib/cli/commands/open'),
	'close': require('../lib/cli/commands/close'),
	'restart': ['close', 'open'],
	'log': require('../lib/cli/commands/log'),
	'logs': require('../lib/cli/commands/log'),
	// 'cms': require('../lib/cli/commands/cms'),
	// 'clear': require('../lib/cli/commands/clear')
};

var suppliedCommand = (function() {
	var args = process.argv.slice(2);
	for (var i=0, len=args.length; i<len; i++) {
		if (args[i] && args[i].charAt(0) != '-') {return args[i];}
	}
	return '';
}());

if (commands.hasOwnProperty(suppliedCommand)) {
	var action = commands[suppliedCommand];
	if (Array.isArray(action)) {
		action.forEach(function(commandName) {new commands[commandName](commandName);});
	} else {
		new action(suppliedCommand);
	}
} else {
	console.error('Invalid tavern command: \'' + suppliedCommand + '\'.\n');
	console.log('Available commands:');
	Object.getOwnPropertyNames(commands).forEach(function(commandName) {
		if (commandName) console.log('\t' + commandName);
	});
	process.exit(1);
}
